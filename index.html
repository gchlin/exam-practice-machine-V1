<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>刷題機 V1</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- 頁面 1: 主頁（題目列表 + Hobbit Log） -->
  <div id="page-main" class="page active">
    
    <!-- 視窗標題列 -->
    <div class="window">
      <div class="title-bar">
        <div class="title-bar-text">刷題機 V1 - 題目列表</div>
        <div class="title-bar-controls">
          <button aria-label="Minimize"></button>
          <button aria-label="Maximize"></button>
          <button aria-label="Close"></button>
        </div>
      </div>
      
      <div class="window-body">
        
        <!-- Hobbit Log 區域 -->
        <fieldset class="hobbit-section">
          <legend>📅 練習熱圖</legend>
          <div id="hobbit-heatmap" class="heatmap-container">
            <!-- 熱圖會在這裡動態生成 -->
          </div>
          <div id="daily-quote" class="daily-quote">
            💪 每天進步一點點，堅持就是勝利！
          </div>
          <div class="hobbit-stats">
            <span>本月練習: <strong id="month-practice-days">0</strong> 天</span>
            <span>總題數: <strong id="month-total-questions">0</strong> 題</span>
            <span>總時間: <strong id="month-total-time">0</strong> 分鐘</span>
          </div>
        </fieldset>
        
        <!-- 篩選器 -->
        <fieldset>
          <legend>🔍 篩選條件</legend>
          <div class="filter-row">
            <label>年份:</label>
            <select id="filter-year">
              <option value="">全部</option>
            </select>
            
            <label>學校:</label>
            <select id="filter-school">
              <option value="">全部</option>
            </select>
            
            <label>章節:</label>
            <select id="filter-chapter">
              <option value="">全部</option>
            </select>
            
            <label>難度:</label>
            <select id="filter-difficulty">
              <option value="">全部</option>
              <option value="1">1 星</option>
              <option value="2">2 星</option>
              <option value="3">3 星</option>
              <option value="4">4 星</option>
              <option value="5">5 星</option>
            </select>
          </div>
          
          <div class="filter-row">
            <label>狀態:</label>
            <select id="filter-status">
              <option value="">全部</option>
              <option value="practiced">已練習</option>
              <option value="unpracticed">未練習</option>
            </select>
            
            <label>搜尋:</label>
            <input type="text" id="filter-search" placeholder="搜尋題目內容...">
            
            <button onclick="applyFilters()">🔍 套用篩選</button>
            <button onclick="resetFilters()">🔄 重設</button>
          </div>
        </fieldset>
        
        <!-- 題目列表 -->
        <fieldset>
          <legend>📝 題目列表 (<span id="question-count">0</span> 題)</legend>
          
          <!-- 顯示選項 -->
          <div class="display-options">
            <label>
              <input type="checkbox" id="show-image" checked onchange="toggleImageColumn()">
              顯示題目圖片
            </label>
            <label>
              <input type="checkbox" id="show-text" checked onchange="toggleTextColumn()">
              顯示題目文字
            </label>
          </div>
          
          <div class="table-container">
            <table id="question-table" class="resizable-table">
              <thead>
                <tr>
                  <th class="col-checkbox"><input type="checkbox" id="select-all" onchange="toggleSelectAll()"></th>
                  <th class="col-number">序號</th>
                  <th class="col-year">年分</th>
                  <th class="col-school">學校</th>
                  <th class="col-chapter">章節</th>
                  <th class="col-difficulty">難度</th>
                  <th class="col-practice">練習次數</th>
                  <th class="col-date">最近練習</th>
                  <th class="col-skip">跳過</th>
                  <th class="col-image">題目圖片</th>
                  <th class="col-text">題目文字</th>
                </tr>
              </thead>
              <tbody id="question-list">
                <!-- 題目列表會在這裡動態生成 -->
              </tbody>
            </table>
          </div>
        </fieldset>
        
        <!-- 底部操作按鈕 -->
        <div class="button-row">
          <div class="button-group">
            <button onclick="loadQuestionBank()">📂 載入題庫</button>
            <button onclick="exportData()">💾 匯出資料</button>
            <button onclick="showStats()">📊 統計分析</button>
          </div>
          
          <div class="button-group">
            <label>
              <input type="checkbox" id="predict-mode">
              預測難度模式
            </label>
            <button onclick="startPractice('normal')" class="primary">▶️ 開始練習</button>
            <button onclick="startPractice('random')">🎲 隨機3題</button>
          </div>
        </div>
        
      </div>
      
      <!-- 狀態列 -->
      <div class="status-bar">
        <div class="status-bar-field">就緒</div>
        <div class="status-bar-field">題庫: <span id="total-questions">0</span> 題</div>
        <div class="status-bar-field">已練習: <span id="practiced-count">0</span> 題</div>
        <div class="status-bar-field" id="status-time">00:00:00</div>
      </div>
    </div>
    
  </div>
  
  <!-- 頁面 2: 刷題頁面 -->
  <div id="page-practice" class="page">
    
    <div class="window practice-window">
      <div class="title-bar">
        <div class="title-bar-text">刷題機 V1 - 練習中</div>
        <div class="title-bar-controls">
          <button aria-label="Minimize"></button>
          <button aria-label="Maximize"></button>
          <button aria-label="Close" onclick="confirmExit()"></button>
        </div>
      </div>
      
      <div class="window-body">
        
        <!-- 題目資訊列 -->
        <div class="practice-header">
          <div class="question-source">
            題目來源: <strong id="current-source">114 蘭陽女中</strong>
          </div>
          <div class="progress-info">
            <span id="current-progress">1 / 10</span>
          </div>
          <div class="timer-display">
            ⏱️ <span id="practice-timer">00:00:00</span>
            <button id="pause-btn" onclick="togglePause()">⏸️</button>
          </div>
        </div>
        
        <!-- 題目顯示區 -->
        <div class="question-display">
          <div class="image-container">
            <img id="question-image" src="" alt="題目圖片">
          </div>
          
          <div class="answer-solution-container" style="display: none;">
            <div class="image-row">
              <div class="image-col">
                <h4>📋 解答</h4>
                <img id="answer-image" src="" alt="解答">
              </div>
              <div class="image-col">
                <h4>📖 詳解</h4>
                <img id="solution-image" src="" alt="詳解">
              </div>
            </div>
          </div>
        </div>
        
        <!-- 控制按鈕 -->
        <div class="practice-controls">
          <div class="nav-buttons">
            <button onclick="prevQuestion()" id="prev-btn">⬅️ 上一題 (←)</button>
            <button onclick="nextQuestion()" id="next-btn">下一題 ➡️ (→)</button>
          </div>
          
          <div class="action-buttons">
            <button onclick="toggleAnswerSolution()">
              <span id="show-answer-text">顯示解答/詳解</span>
            </button>
            <button onclick="markCorrect()" class="success">✓ 答對 (C)</button>
            <button onclick="markIncorrect()" class="danger">✗ 答錯 (X)</button>
            <button onclick="markSkip()" class="warning">⊘ 跳過 (S)</button>
          </div>
        </div>
        
        <!-- 難度評價與筆記 -->
        <fieldset>
          <legend>⭐ 難度評價</legend>
          <div class="difficulty-rating">
            <span class="star" data-value="1" onclick="setDifficulty(1)">☆</span>
            <span class="star" data-value="2" onclick="setDifficulty(2)">☆</span>
            <span class="star" data-value="3" onclick="setDifficulty(3)">☆</span>
            <span class="star" data-value="4" onclick="setDifficulty(4)">☆</span>
            <span class="star" data-value="5" onclick="setDifficulty(5)">☆</span>
            <span class="difficulty-hint">按 1-5 鍵快速評分</span>
          </div>
        </fieldset>
        
        <fieldset>
          <legend>📝 筆記</legend>
          <textarea id="practice-notes" rows="3" placeholder="記錄解題心得、易錯點..."></textarea>
        </fieldset>
        
        <!-- 底部按鈕 -->
        <div class="button-row">
          <button onclick="saveForLater()">💾 改天再戰</button>
          <button onclick="backToList()">⬅️ 回到列表</button>
          <button onclick="finishPractice()" class="primary">✓ 完成練習</button>
        </div>
        
      </div>
      
      <!-- 狀態列 -->
      <div class="status-bar">
        <div class="status-bar-field"><span id="status-message">練習中...</span></div>
        <div class="status-bar-field">答對: <span id="correct-count">0</span></div>
        <div class="status-bar-field">答錯: <span id="incorrect-count">0</span></div>
        <div class="status-bar-field">跳過: <span id="skip-count">0</span></div>
      </div>
    </div>
    
  </div>
  
  <!-- 統計分析彈窗 -->
  <div id="stats-modal" class="modal" style="display: none;">
    <div class="window modal-window">
      <div class="title-bar">
        <div class="title-bar-text">📊 統計分析</div>
        <div class="title-bar-controls">
          <button aria-label="Close" onclick="closeStatsModal()"></button>
        </div>
      </div>
      <div class="window-body">
        <div id="stats-content">
          <!-- 統計內容會動態生成 -->
        </div>
        <div class="button-row center">
          <button onclick="closeStatsModal()">關閉</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 載入題庫彈窗 -->
  <div id="load-modal" class="modal" style="display: none;">
    <div class="window modal-window-small">
      <div class="title-bar">
        <div class="title-bar-text">📂 載入題庫</div>
        <div class="title-bar-controls">
          <button aria-label="Close" onclick="closeLoadModal()"></button>
        </div>
      </div>
      <div class="window-body">
        <fieldset>
          <legend>選擇載入方式</legend>
          
          <div class="field-row">
            <input type="radio" name="load-mode" id="load-online" value="online" checked>
            <label for="load-online">線上題庫 (使用伺服器上的 data.csv)</label>
          </div>
          
          <div class="field-row">
            <input type="radio" name="load-mode" id="load-local" value="local">
            <label for="load-local">本地檔案</label>
          </div>
          
          <div class="field-row" id="local-file-row" style="display: none;">
            <label>選擇 CSV 檔案:</label>
            <input type="file" id="csv-file-input" accept=".csv">
          </div>
        </fieldset>
        
        <div class="progress-container" id="load-progress" style="display: none;">
          <div class="progress-bar">
            <div class="progress-fill" id="load-progress-fill"></div>
          </div>
          <div class="progress-text" id="load-progress-text">載入中...</div>
        </div>
        
        <div class="button-row center">
          <button onclick="executeLoad()" class="primary">開始載入</button>
          <button onclick="closeLoadModal()">取消</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 通用對話框 -->
  <div id="dialog-modal" class="modal" style="display: none;">
    <div class="window modal-window-small">
      <div class="title-bar">
        <div class="title-bar-text" id="dialog-title">訊息</div>
        <div class="title-bar-controls">
          <button aria-label="Close" onclick="closeDialog()"></button>
        </div>
      </div>
      <div class="window-body">
        <div class="dialog-content">
          <div id="dialog-message"></div>
        </div>
        <div class="button-row center">
          <button onclick="closeDialog()" id="dialog-ok-btn">確定</button>
          <button onclick="closeDialog()" id="dialog-cancel-btn" style="display: none;">取消</button>
        </div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
