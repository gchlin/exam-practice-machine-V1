<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åˆ·é¡Œæ©Ÿ V2.0</title>
  <link id="theme-style" rel="stylesheet" href="style-win98.css">
  <style>
    /* ç™»å…¥å€å¡Š */
    .auth-box {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: rgba(255, 255, 255, 0.6);
      border-bottom: 1px solid #ccc;
      flex-wrap: wrap;
    }
    .auth-box input {
      padding: 4px 6px;
      font-size: 12px;
      min-width: 160px;
    }
    .auth-box .win98-button.small {
      padding: 4px 8px;
      font-size: 11px;
    }
    .auth-box .auth-status {
      font-size: 12px;
      color: #333;
      min-height: 16px;
    }

    /* é¢¨æ ¼åˆ‡æ›æŒ‰éˆ• */
    .theme-switcher {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .theme-btn {
      padding: 4px 10px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 11px;
      border: 2px solid transparent;
      transition: all 0.3s;
      background: rgba(255, 255, 255, 0.3);
      color: #fff;
    }
    .theme-btn:hover {
      background: rgba(255, 255, 255, 0.5);
    }
    .theme-btn.active {
      border-color: #fff;
      background: rgba(255, 255, 255, 0.6);
      font-weight: bold;
    }

    /* åŒ¯å‡ºé€²åº¦é®ç½© */
    #export-progress-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    #export-progress-overlay .overlay-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.35);
    }
    #export-progress-overlay .overlay-content {
      position: relative;
      background: #fff;
      border: 2px solid #000;
      padding: 16px 20px;
      border-radius: 6px;
      min-width: 260px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    #export-progress-overlay .spinner {
      width: 32px;
      height: 32px;
      border: 4px solid #d0d0d0;
      border-top-color: #000;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    #export-progress-overlay .overlay-text {
      font-size: 13px;
      text-align: center;
      color: #000;
    }
    .coverage-table-wrapper {
      max-height: 70vh;
      overflow: auto;
      background: #fdfdfd;
      padding: 10px;
      border: 2px solid #6b6b6b;
      box-shadow: inset 0 1px 0 #fff, inset 1px 0 0 #fff, 0 2px 6px rgba(0, 0, 0, 0.2);
    }
    .coverage-table th,
    .coverage-table td {
      white-space: nowrap;
      vertical-align: top;
      text-align: center;
      border: 1px solid #b6b6b6;
      padding: 6px 10px;
      font-size: 13px;
    }
    .coverage-table th.row-school {
      text-align: left;
    }
    .coverage-table thead th {
      background: linear-gradient(#f7f7f7, #dfdfdf);
      font-weight: 700;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .coverage-table tbody th {
      background: #f4f4f4;
      font-weight: 600;
      position: sticky;
      left: 0;
      z-index: 1;
    }
    .coverage-table tbody tr:nth-child(odd) td {
      background: #fafafa;
    }
    .coverage-table td {
      font-size: 16px;
      color: #222;
    }
    .coverage-table thead th {
      color: #111;
    }
    .coverage-modal .modal-content {
      max-width: 95vw;
      width: auto;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

  <!-- ä¸»è¦–çª— -->
  <div class="win98-window">
    
    <!-- æ¨™é¡Œåˆ— -->
    <div class="win98-titlebar">
      <div class="win98-titlebar-text">åˆ·é¡Œæ©Ÿ V2.0</div>
      <div class="theme-switcher">
        <div class="theme-btn active" onclick="switchTheme('win98')" id="theme-win98">å¾©å¤</div>
        <div class="theme-btn" onclick="switchTheme('pastel')" id="theme-pastel">æŸ”å’Œ</div>
      </div>
      <div class="win98-titlebar-buttons">
        <div class="win98-titlebar-button">_</div>
        <div class="win98-titlebar-button">â–¡</div>
        <div class="win98-titlebar-button">âœ•</div>
      </div>
    </div>

    <!-- ç™»å…¥/è¨»å†Š -->
    <div class="auth-box">
      <input id="auth-email" type="email" placeholder="Email" class="win98-input">
      <input id="auth-password" type="password" placeholder="Password" class="win98-input">
      <button id="btn-signup" class="win98-button small">è¨»å†Š</button>
      <button id="btn-signin" class="win98-button small">ç™»å…¥</button>
      <button id="btn-signout" class="win98-button small" style="display:none;">ç™»å‡º</button>
      <span id="auth-status" class="auth-status">æœªç™»å…¥</span>
      <label class="small" style="display:flex; align-items:center; gap:4px; margin-left:8px;">
        <input type="checkbox" id="toggle-bg-sync" style="margin:0;">
        <span>å•Ÿç”¨èƒŒæ™¯åŒæ­¥</span>
      </label>
      <span class="small" style="color:#666;">ï¼ˆæ›è£ç½®å‰è«‹æŒ‰ â˜ï¸ åŒæ­¥ï¼‰</span>
    </div>

    <!-- ä¸»è¦å…§å®¹ -->
    <div class="win98-content">

      <!-- ========== é é¢ 0: è¼‰å…¥é¡Œåº« ========== -->
      <div id="page-load" class="page active">
        <div class="section-title">æ­¥é©Ÿ 1ï¼šè¼‰å…¥é¡Œåº« data.csv</div>
        
        <div class="field-row">
          <span class="label">è¼‰å…¥æ–¹å¼ï¼š</span>
          <label>
            <input type="radio" name="load-mode" value="online" checked>
            ç·šä¸Šé¡Œåº« (data.csv)
          </label>
          <label>
            <input type="radio" name="load-mode" value="local">
            æœ¬åœ°æª”æ¡ˆ
          </label>
        </div>

        <div class="field-row" id="local-file-row" style="display: none;">
          <span class="label">é¸æ“‡ CSVï¼š</span>
          <input id="file-input" type="file" accept=".csv">
        </div>

        <div class="field-row">
          <button id="btn-load-csv" class="win98-button">è¼‰å…¥é¡Œåº«</button>
        </div>

        <div id="load-progress" class="progress-container" style="display: none;">
          <div class="progress-bar">
            <div class="progress-fill" id="load-progress-fill"></div>
          </div>
          <div class="progress-text" id="load-progress-text">è¼‰å…¥ä¸­...</div>
        </div>

        <div class="small mt-8">
          å»ºè­°ï¼šä½¿ç”¨æœ¬åœ°ä¼ºæœå™¨é–‹å•Ÿï¼ˆ<code>python -m http.server 8000</code>ï¼‰ï¼Œ<br/>
          åœ–ç‰‡è·¯å¾‘å¯«æˆ <code>images/xxx.webp</code>ã€‚
        </div>

        <div id="load-status" class="mt-8 small"></div>
      </div>

      <!-- ========== é é¢ 1: é¡Œç›®åˆ—è¡¨ ========== -->
      <div id="page-list" class="page">
        
        <!-- é ‚éƒ¨è³‡è¨Šæ¬„ -->
        <div class="top-info-bar">
          <div class="info-left">
            <div class="section-title-inline">ğŸ“ é¡Œç›®åˆ—è¡¨ (<span id="filtered-count">0</span> / <span id="total-count">0</span> é¡Œ)</div>
          </div>
          
          <div class="info-center">
            <!-- Hobbit Log ç†±åŠ›åœ– -->
            <div class="heatmap-inline" id="heatmap"></div>
          </div>
          
          <div class="info-right">
            <!-- æœ¬æœˆçµ±è¨ˆ -->
            <div class="month-stats">
              <div class="small" id="month-stats-text">æœ¬æœˆï¼š0å¤© / 0é¡Œ / 0åˆ†é˜</div>
              <div class="motivational-quote">"æŒä¹‹ä»¥æ†ï¼Œå¿…æœ‰æ‰€æˆ"</div>
            </div>
          </div>
        </div>

        <div class="mobile-layout">
          <!-- åˆä½µï¼šæ¨¡å¼é¸æ“‡ + é–‹å§‹æŒ‰éˆ• -->
          <div class="mobile-start-row">
            <div class="mobile-mode-radios">
              <label class="mode-option">
                <input type="radio" name="mobile-practice-mode" value="new" checked>
                æ–°é¡Œ
              </label>
              <label class="mode-option">
                <input type="radio" name="mobile-practice-mode" value="browse">
                ç€è¦½
              </label>
              <label class="mode-option">
                <input type="radio" name="mobile-practice-mode" value="mobile">
                è§¸æ§
              </label>
            </div>
            <button id="btn-mobile-main-practice" class="win98-button mobile-main-button">é–‹å§‹ç·´ç¿’</button>
          </div>
          <div class="mobile-secondary-actions">
            <button id="btn-start-selected" class="win98-button small">å‹¾é¸é¡Œç›®ç·´ç¿’</button>
            <button id="btn-open-filter-modal" class="win98-button small">ç¯©é¸</button>
          </div>

          <!-- ç¯©é¸å½ˆçª— -->
          <div id="filter-modal" class="modal" style="display: none;">
            <div class="modal-content filter-modal-content">
              <div class="modal-header">ç¯©é¸æ¢ä»¶</div>
              <div class="filter-grid">
                <label class="small">
                  ç« ç¯€
                  <select id="filter-chapter" class="win98-input">
                    <option value="">å…¨éƒ¨</option>
                  </select>
                </label>
                <label class="small">
                  ä½œç­”ç‹€æ…‹
                  <select id="filter-status" class="win98-input">
                    <option value="">å…¨éƒ¨</option>
                    <option value="last-correct">ä¸Šæ¬¡å°</option>
                    <option value="last-wrong">ä¸Šæ¬¡éŒ¯</option>
                    <option value="never">æ²’åšé</option>
                  </select>
                </label>
                <label class="small">
                  å¹´ä»½
                  <select id="filter-year" class="win98-input">
                    <option value="">å…¨éƒ¨</option>
                  </select>
                </label>
                <label class="small">
                  å­¸æ ¡
                  <select id="filter-school" class="win98-input">
                    <option value="">å…¨éƒ¨</option>
                  </select>
                </label>
                <label class="small">
                  æ‹›è€ƒ
                  <select id="filter-recruitment" class="win98-input">
                    <option value="">å…¨éƒ¨</option>
                    <option value="å…¬è€ƒ">å…¬è€ƒ</option>
                    <option value="æ ¡è€ƒ">æ ¡è€ƒ</option>
                  </select>
                </label>
                <label class="small">
                  é¡Œå‹
                  <select id="filter-type" class="win98-input">
                    <option value="">å…¨éƒ¨</option>
                  </select>
                </label>
                <label class="small">
                  èªè¨€
                  <select id="filter-lang" class="win98-input">
                    <option value="">å…¨éƒ¨</option>
                    <option value="zh">ä¸­æ–‡</option>
                    <option value="en">è‹±æ–‡</option>
                  </select>
                </label>
                <label class="small">
                  é›£åº¦
                  <select id="filter-rating" class="win98-input">
                    <option value="">å…¨éƒ¨</option>
                    <option value="1">1 â˜…</option>
                    <option value="2">2 â˜…</option>
                    <option value="3">3 â˜…</option>
                    <option value="4">4 â˜…</option>
                    <option value="5">5 â˜…</option>
                  </select>
                </label>
                <label class="small">
                  æœå°‹
                  <input type="text" id="filter-search" class="win98-input" placeholder="é¡Œç›®/é—œéµå­—/ç­†è¨˜é—œéµå­—">
                </label>
              </div>
              <div class="filter-actions modal-actions">
                <button id="btn-apply-filter" class="win98-button">å¥—ç”¨</button>
                <button id="btn-reset-filter" class="win98-button">é‡è¨­</button>
                <button id="btn-close-filter" class="win98-button">å–æ¶ˆ</button>
              </div>
            </div>
          </div>

          <details class="mobile-tools-panel">
            <summary>â–¶ å·¥å…·</summary>
            <div class="mobile-tools-grid">
              <button id="btn-sync-cloud" class="win98-button small" title="é›²ç«¯åŒæ­¥ï¼ˆè·¨è£ç½®ï¼‰">â˜ï¸ åŒæ­¥</button>
              <button id="btn-reload-questions" class="win98-button small" title="å¼·åˆ¶é‡æ–°ä¸‹è¼‰é¡Œåº«ï¼ˆé¿å…å¿«å–ï¼‰">ğŸ”„ æ›´æ–°é¡Œåº«</button>
              <button id="btn-export-logs" class="win98-button small" title="åŒ¯å‡ºç­”é¡Œè¨˜éŒ„">ğŸ“¤ åŒ¯å‡º</button>
              <button id="btn-import-logs" class="win98-button small" title="åŒ¯å…¥ç­”é¡Œè¨˜éŒ„">ğŸ“¥ åŒ¯å…¥</button>
              <button id="btn-export-pdf" class="win98-button small">åŒ¯å‡º PDF</button>
            </div>
          </details>

          <div class="mobile-bottom-links">
            <button id="btn-show-stats" class="win98-button small">çµ±è¨ˆåˆ†æ</button>
            <button id="btn-show-coverage" class="win98-button small">æ”¶éŒ„é¡Œç›®åˆ—è¡¨</button>
            <button id="btn-view-log" class="win98-button small">æŸ¥çœ‹ç·´ç¿’ç´€éŒ„</button>
          </div>
        </div>

        <div class="display-options mt-4">
          <label class="small">
            <input type="checkbox" id="show-image" checked>
            é¡¯ç¤ºé¡Œç›®åœ–ç‰‡
          </label>
          <label class="small">
            <input type="checkbox" id="show-text" checked>
            é¡¯ç¤ºé¡Œç›®æ–‡å­—
          </label>
          <label class="small">
            <input type="checkbox" id="show-school" checked>
            é¡¯ç¤ºå­¸æ ¡
          </label>
          <span class="small ml-8">
            å·²é¸ <span id="selected-count">0</span> é¡Œ
          </span>
        </div>

        <!-- é¡Œç›®è¡¨æ ¼ - å¯æ»¾å‹•å€åŸŸ -->
        <div class="table-container">
          <table id="questions-table" class="compact-table">
            <thead>
              <tr>
                <th class="col-check"><input type="checkbox" id="chk-all"></th>
                <th class="col-year">å¹´åˆ†</th>
                <th class="col-school">å­¸æ ¡</th>
                <th class="col-chapter">ç« ç¯€</th>
                <th class="col-diff">é›£åº¦</th>
                <th class="col-image">é¡Œç›®åœ–ç‰‡</th>
                <th class="col-text">é¡Œç›®æ–‡å­—</th>
                <th class="col-count">ç·´ç¿’</th>
                <th class="col-date">æœ€è¿‘</th>
                <th class="col-skip">è·³é</th>
              </tr>
            </thead>
            <tbody id="questions-tbody">
              <!-- å‹•æ…‹ç”Ÿæˆ -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- ========== é é¢ 2: é æ¸¬é›£åº¦ ========== -->
      <div id="page-predict" class="page">
        <div class="section-title">é æ¸¬é›£åº¦ï¼ˆ1-5æ˜Ÿï¼‰</div>
        
        <!-- é€²åº¦é¡¯ç¤º -->
        <div class="predict-progress">
          ç¬¬ <span id="predict-current">1</span> / <span id="predict-total">1</span> é¡Œ
        </div>

        <!-- å–®é¡Œé¡¯ç¤ºå€ -->
        <div class="predict-single-view">
          <!-- é¡Œç›®è³‡è¨Š -->
          <div class="predict-info-bar">
            <div>Q_ID: <strong id="predict-qid">-</strong></div>
            <div><strong id="predict-meta">-</strong></div>
          </div>

          <!-- é¡Œç›®åœ–ç‰‡ï¼ˆå¤§åœ–ï¼‰ -->
          <div class="predict-image-container">
            <img id="predict-image" src="" alt="é¡Œç›®åœ–ç‰‡" onclick="enlargeImage(this.src)">
          </div>

          <!-- è©•åˆ†å€ -->
          <div class="predict-rating-area">
            <div class="predict-instruction">
              è«‹è©•ä¼°æ­¤é¡Œé›£åº¦ï¼ˆæŒ‰éµç›¤ 1-5 æˆ–é»æ“Šæ˜Ÿæ˜Ÿï¼‰
            </div>
            <div class="stars predict-stars" id="predict-stars">
              <span class="star" data-value="1" onclick="predictSetDiff(1)">â˜†</span>
              <span class="star" data-value="2" onclick="predictSetDiff(2)">â˜†</span>
              <span class="star" data-value="3" onclick="predictSetDiff(3)">â˜†</span>
              <span class="star" data-value="4" onclick="predictSetDiff(4)">â˜†</span>
              <span class="star" data-value="5" onclick="predictSetDiff(5)">â˜†</span>
            </div>
            <div class="small mt-4">
              æŒ‰å®Œæ•¸å­—éµæœƒè‡ªå‹•è·³ä¸‹ä¸€é¡Œ | æ–¹å‘éµ â† â†’ åˆ‡æ›é¡Œç›®
            </div>
          </div>
        </div>

        <div class="predict-nav mt-4">
          <button id="btn-predict-prev" class="win98-button small">ä¸Šä¸€é¡Œ</button>
          <button id="btn-predict-next" class="win98-button small ml-4">ä¸‹ä¸€é¡Œ</button>
          <span class="small ml-4">ä¹Ÿå¯é»æ“ŠæŒ‰éˆ•åˆ‡æ›</span>
        </div>

        <div class="mt-8">
          <button id="btn-back-to-list" class="win98-button">å›åˆ—è¡¨</button>
          <button id="btn-start-practice" class="win98-button">é–‹å§‹æ­£å¼åˆ·é¡Œ (Enter)</button>
        </div>
      </div>

      <!-- ========== é é¢ 3: æ­£å¼åˆ·é¡Œ ========== -->
      <div id="page-practice" class="page">
        <div class="section-title">æ­£å¼åˆ·é¡Œ</div>
        <div class="mt-4">
          <button id="btn-practice-back" class="win98-button small">å›é¡Œåº«åˆ—è¡¨</button>
        </div>

        <!-- é¡Œç›®è³‡è¨Š -->
        <div class="practice-header">
          <div class="practice-info highlight">
            ç¬¬ <span id="current-num">1</span> / <span id="total-num">1</span> é¡Œ | 
            Q_ID: <span id="current-qid">-</span> | 
            <span id="current-meta">-</span>
          </div>
          
          <!-- é›™è¨ˆæ™‚å™¨ -->
          <div class="timer-group">
            <div class="timer-item">
              <span class="label">ç¸½æ™‚é–“:</span>
              <div class="timer-display" id="timer-total">00:00</div>
            </div>
            <div class="timer-item">
              <span class="label">æœ¬é¡Œ:</span>
              <div class="timer-display" id="timer-single">00:00</div>
            </div>
            <button id="btn-timer-toggle" class="win98-button small">é–‹å§‹</button>
            <button id="btn-timer-reset" class="win98-button small">é‡è¨­</button>
          </div>
        </div>

        <!-- é¡Œç›®é¡¯ç¤º - å›ºå®šç‰ˆé¢ -->
        <div class="practice-layout">
          <!-- å·¦å´ï¼šé¡Œç›®åœ–ç‰‡ -->
          <div class="practice-left">
            <div class="small mb-4">é¡Œç›®åœ–ç‰‡ï¼ˆé»æ“Šæ”¾å¤§ï¼‰ï¼š</div>
            <div class="image-frame">
              <img id="practice-problem-img" class="problem-image" alt="é¡Œç›®åœ–ç‰‡" onclick="enlargeImage(this.src)">
            </div>
          </div>

          <!-- å³å´ï¼šè§£ç­”è©³è§£ -->
          <div class="practice-right">
            <div class="small mb-4">è§£ç­” / è©³è§£ï¼š</div>
            <div class="image-frame" id="answer-frame">
              <div id="answer-placeholder" class="answer-placeholder">
                æŒ‰ä¸‹æŒ‰éˆ•é¡¯ç¤ºè§£ç­”
              </div>
              <div id="answer-container" style="display: none;">
                <img id="practice-answer-img" class="answer-image" alt="è§£ç­”åœ–ç‰‡" onclick="enlargeImage(this.src)">
                <img id="practice-solution-img" class="solution-image mt-4" alt="è©³è§£åœ–ç‰‡" onclick="enlargeImage(this.src)">
              </div>
            </div>
            <button id="btn-toggle-answer" class="win98-button mt-4">é¡¯ç¤ºè§£ç­”/è©³è§£ (A)</button>
          </div>
        </div>

        <!-- æ§åˆ¶å€åŸŸ -->
        <div class="practice-controls">
          <!-- ä½œç­”çµæœ -->
          <div class="field-row">
            <span class="label">ä½œç­”çµæœï¼š</span>
            <button id="btn-correct" class="win98-button">âœ“ æ­£ç¢º (C)</button>
            <button id="btn-wrong" class="win98-button">âœ— éŒ¯èª¤ (X)</button>
            <button id="btn-skip" class="win98-button">âŠ˜ è·³é (S)</button>

            <button id="btn-prev" class="win98-button ml-8">ä¸Šä¸€é¡Œ (â†)</button>
            <button id="btn-next" class="win98-button">ä¸‹ä¸€é¡Œ (â†’)</button>
          </div>

          <!-- é›£åº¦è©•åƒ¹ -->
          <div class="field-row">
            <span class="label">å¯¦éš›é›£åº¦ï¼š</span>
            <div class="stars" id="difficulty-stars">
              <span class="star" data-value="1" onclick="setDifficulty(1)">â˜†</span>
              <span class="star" data-value="2" onclick="setDifficulty(2)">â˜†</span>
              <span class="star" data-value="3" onclick="setDifficulty(3)">â˜†</span>
              <span class="star" data-value="4" onclick="setDifficulty(4)">â˜†</span>
              <span class="star" data-value="5" onclick="setDifficulty(5)">â˜†</span>
            </div>
            <span class="small ml-4">ï¼ˆé æ¸¬ï¼š<span id="predicted-diff">-</span> é¡†æ˜Ÿï¼‰ï¼ˆéµç›¤ 1-5ï¼‰</span>
          </div>

          <!-- ç­†è¨˜ -->
          <div class="panel">
            <div class="flex-row" style="justify-content: space-between; align-items: center;">
              <div class="small">Notesï¼ˆç­†è¨˜ï¼‰ï¼š</div>
              <button id="btn-save-note" class="win98-button small">ğŸ’¾ å­˜æª” (Ctrl+S)</button>
            </div>
            <textarea id="practice-notes" class="win98-input mt-4"></textarea>
          </div>

          <!-- çµæŸ/é›¢é–‹ -->
          <div class="mt-4">
            <button id="btn-save-later" class="win98-button">ğŸ’¾ æ”¹å¤©å†æˆ°</button>
            <button id="btn-end-session" class="win98-button">âœ“ çµæŸæœ¬è¼ªä¸¦çœ‹ Summary (Enter)</button>
          </div>
        </div>

        <!-- æ‰‹æ©Ÿå°ˆç”¨å›ºå®šæ“ä½œåˆ— (2å±¤ç²¾ç°¡ç‰ˆ) -->
        <div class="mobile-action-bar" id="mobile-action-bar" style="display: none;">
          <!-- ç¬¬ä¸€å±¤ï¼šå°èˆª + é¡¯ç¤ºè§£ç­” -->
          <div class="mobile-quick-actions">
            <button class="mobile-btn mobile-btn-secondary" id="mobile-prev">â†</button>
            <button class="mobile-btn mobile-btn-primary" id="mobile-toggle-answer">é¡¯ç¤ºè§£ç­”</button>
            <button class="mobile-btn mobile-btn-secondary" id="mobile-next">â†’</button>
          </div>

          <!-- ç¬¬äºŒå±¤ï¼šä½œç­”çµæœ + é›£åº¦æŒ‰éˆ• -->
          <div class="mobile-main-actions">
            <button class="mobile-btn mobile-btn-correct" id="mobile-correct">âœ“</button>
            <button class="mobile-btn mobile-btn-wrong" id="mobile-wrong">âœ—</button>
            <button class="mobile-btn mobile-btn-skip" id="mobile-skip">âŠ˜</button>
            <button class="mobile-btn mobile-btn-difficulty" id="mobile-difficulty-btn">â˜…</button>
          </div>

          <!-- é›£åº¦è©•åˆ†å½ˆçª— (éš±è—) -->
          <div class="mobile-difficulty" id="mobile-difficulty-panel">
            <span class="mobile-label">é›£åº¦ï¼š</span>
            <div class="mobile-stars" id="mobile-difficulty-stars">
              <button class="mobile-star" data-value="1">â˜…</button>
              <button class="mobile-star" data-value="2">â˜…</button>
              <button class="mobile-star" data-value="3">â˜…</button>
              <button class="mobile-star" data-value="4">â˜…</button>
              <button class="mobile-star" data-value="5">â˜…</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ========== é é¢ 4: ç·´ç¿’ç´€éŒ„æª¢è¦– ========== -->
      <div id="page-log" class="page">
        <div class="section-title">ç·´ç¿’ç´€éŒ„</div>
        <div class="log-layout">
          <div class="log-dates">
            <div class="log-dates-title">æ—¥æœŸ</div>
            <ul id="log-date-list"></ul>
          </div>
          <div class="log-details">
            <div class="log-details-header">
              <span id="log-selected-date">è«‹é¸æ“‡æ—¥æœŸ</span>
              <div class="log-details-actions">
                <button id="btn-log-replay" class="win98-button small" disabled>å†æ¬¡ç·´é€™æ‰¹</button>
                <button id="btn-log-back" class="win98-button small">å›åˆ—è¡¨</button>
              </div>
            </div>
            <div id="log-items"></div>
          </div>
        </div>
      </div>

      <!-- ========== é é¢ 5: æ‰‹æ©Ÿç€è¦½ ========== -->
      <div id="page-mobile-browse" class="page">
        <div class="section-title">æ‰‹æ©Ÿç€è¦½æ¨¡å¼</div>
        <div class="mobile-browse-wrap">
          <div class="mobile-browse-meta">
            <div id="mb-qid">Q_ID: -</div>
            <div id="mb-meta">- / - / -</div>
          </div>
          <div class="mobile-browse-image-frame">
            <img id="mb-problem-img" alt="é¡Œç›®åœ–ç‰‡">
          </div>
          <div class="mobile-browse-controls">
            <button id="mb-prev" class="mobile-browse-btn">ä¸Šä¸€é¡Œ</button>
            <div class="mobile-browse-stars" id="mb-stars">
              <button class="mb-star" data-value="1">â˜…</button>
              <button class="mb-star" data-value="2">â˜…</button>
              <button class="mb-star" data-value="3">â˜…</button>
              <button class="mb-star" data-value="4">â˜…</button>
              <button class="mb-star" data-value="5">â˜…</button>
            </div>
            <button id="mb-next" class="mobile-browse-btn">ä¸‹ä¸€é¡Œ</button>
          </div>
          <div class="mt-4">
            <button id="btn-mobile-browse-back" class="mobile-btn mobile-btn-secondary">å›åˆ—è¡¨</button>
          </div>
        </div>
      </div>

      <!-- ========== é é¢ 6: Summary ========== -->
      <div id="page-summary" class="page">
        <div class="section-title">æœ¬è¼ª Summary</div>
        <div id="summary-content" class="summary-panel">
          <!-- å‹•æ…‹ç”Ÿæˆ -->
        </div>

        <div class="mt-8">
          <button id="btn-summary-back" class="win98-button">å›åˆ°é¡Œç›®åˆ—è¡¨</button>
        </div>
      </div>

    </div>

    <!-- ç‹€æ…‹åˆ— -->
    <div class="win98-statusbar">
      <span id="status-left">å°±ç·’</span>
      <span id="status-right">åˆ·é¡Œæ©Ÿ V1</span>
    </div>

  </div>

  <!-- å°è©±æ¡†ï¼šåœ–ç‰‡é è¦½ -->
  <div id="image-modal" class="modal" style="display: none;" onclick="closeImageModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-title-group">
          <span>åœ–ç‰‡é è¦½</span>
          <span id="modal-meta" class="small"></span>
        </div>
        <span class="modal-close" onclick="closeImageModal()">âœ•</span>
      </div>
      <div class="modal-body">
        <img id="modal-image" src="" alt="é è¦½åœ–ç‰‡">
      </div>
    </div>
  </div>

  <!-- å°è©±æ¡†ï¼šé€šç”¨è¨Šæ¯ -->
  <!-- æ”¶éŒ„é¡Œç›®åˆ—è¡¨ -->
  <div id="coverage-modal" class="modal" style="display: none;" onclick="closeCoverageModal()">
    <div class="modal-content coverage-modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <span>æ”¶éŒ„é¡Œç›®åˆ—è¡¨</span>
        <span class="modal-close" onclick="closeCoverageModal()">&times;</span>
      </div>
      <div class="modal-body">
        <p class="small" id="coverage-empty" style="display:none;">ç›®å‰å°šæœªæ”¶éŒ„é¡Œç›®ï¼Œè«‹å…ˆè¼‰å…¥æ–°çš„é¡Œåº«ã€‚</p>
        <div class="small" style="margin-bottom: 8px;">ç¬¬ä¸€è¡Œç‚ºå¹´ä»½ï¼ˆç”±å°åˆ°å¤§ï¼‰ï¼Œç¬¬ä¸€åˆ—ç‚ºå­¸æ ¡ï¼ˆç­†é †æ’åºï¼‰ã€‚</div>
        <div class="coverage-table-wrapper">
          <table id="coverage-table" class="compact-table coverage-table">
            <thead id="coverage-table-head"></thead>
            <tbody id="coverage-table-body"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div id="message-modal" class="modal" style="display: none;">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <span id="message-title">è¨Šæ¯</span>
        <span class="modal-close" onclick="closeMessageModal()">âœ•</span>
      </div>
      <div class="modal-body">
        <div id="message-text"></div>
      </div>
      <div class="modal-footer">
        <button id="message-ok" class="win98-button" onclick="closeMessageModal()">ç¢ºå®š</button>
        <button id="message-cancel" class="win98-button" onclick="closeMessageModal()" style="display: none;">å–æ¶ˆ</button>
      </div>
    </div>
  </div>

  <!-- å°è©±æ¡†ï¼šç¹¼çºŒæœªå®Œæˆç·´ç¿’ -->
  <div id="continue-modal" class="modal" style="display: none;">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <span>ç™¼ç¾æœªå®Œæˆçš„ç·´ç¿’</span>
      </div>
      <div class="modal-body">
        <p>ä¸Šæ¬¡æœ‰æœªå®Œæˆçš„ç·´ç¿’æœƒè©±ï¼Œæ˜¯å¦ç¹¼çºŒï¼Ÿ</p>
        <p class="small mt-4">
          é¡Œæ•¸ï¼š<span id="continue-count">0</span> é¡Œ<br>
          å·²å®Œæˆï¼š<span id="continue-done">0</span> é¡Œ
        </p>
      </div>
      <div class="modal-footer">
        <button id="btn-continue-yes" class="win98-button">ç¹¼çºŒç·´ç¿’</button>
        <button id="btn-continue-no" class="win98-button">æ”¾æ£„ä¸¦é‡æ–°é–‹å§‹</button>
      </div>
    </div>
  </div>

  <!-- å°è©±æ¡†ï¼šåŒ¯å‡º PDF -->
  <div id="export-modal" class="modal" style="display: none;">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <span>åŒ¯å‡º PDF</span>
        <span class="modal-close" onclick="closeExportModal()">Ã—</span>
      </div>
      <div class="modal-body">
        <p class="small" id="export-selection-hint">å·²é¸ 0 é¡Œ</p>
        <label class="small" style="display:block; margin:6px 0;">
          <input type="radio" name="export-layout" value="single" checked> ç›´å¼å–®æ¬„ï¼ˆA4ï¼Œé¡Œç›®å…ˆã€ç­”æ¡ˆå¾Œï¼‰
        </label>
        <label class="small" style="display:block; margin:6px 0;">
          <input type="radio" name="export-layout" value="double"> æ©«å¼é›™æ¬„ï¼ˆB4ï¼Œé¡Œç›®é›™æ¬„ï¼Œç­”æ¡ˆæœ€å¾Œï¼‰
        </label>
        <p class="small" style="margin-top:8px;">æ’åˆ—æ–¹å¼ï¼š</p>
        <label class="small" style="display:block; margin:6px 0;">
          <input type="radio" name="export-order" value="original" checked> ä¾å‹¾é¸é †åºï¼ˆé¡Œè™Ÿ A001 èµ·ï¼Œä¾åŸé †åºéå¢ï¼‰
        </label>
        <label class="small" style="display:block; margin:6px 0;">
          <input type="radio" name="export-order" value="ffd"> è‡ªå‹•çœç´™æ’åˆ—ï¼ˆå…ˆæ”¾è¼ƒé«˜é¡Œç›®ä»¥ç¯€çœé æ•¸ï¼Œé¡Œè™Ÿä»é€£çºŒï¼‰
        </label>
        <label class="small" style="display:block; margin:8px 0 0 0;">
          <input type="checkbox" id="export-calc-area"> ä¿ç•™è¨ˆç®—å€ï¼ˆæ¯é ç­‰åˆ†æ¬„ä½ï¼Œé è¨­ 3 é¡Œï¼Œéé«˜è‡ªå‹•é™ç‚º 2 é¡Œæˆ– 1 é¡Œï¼‰
        </label>
        <p class="small" style="margin-top:8px;">åŒ¯å‡ºç¯„åœï¼šåƒ…åŒ¯å‡ºå·²å‹¾é¸çš„é¡Œç›®ï¼Œè‹¥æœªå‹¾é¸å‰‡ç„¡æ³•åŒ¯å‡ºã€‚</p>
      </div>
      <div class="modal-footer">
        <button class="win98-button" onclick="closeExportModal()">å–æ¶ˆ</button>
        <button class="win98-button" id="btn-export-confirm">é–‹å§‹åŒ¯å‡º</button>
      </div>
    </div>
  </div>

  <!-- åŒ¯å‡ºé€²åº¦é®ç½© -->
  <div id="export-progress-overlay" style="display:none;">
    <div class="overlay-backdrop"></div>
    <div class="overlay-content">
      <div class="spinner"></div>
      <div class="overlay-text" id="export-progress-text">æ­£åœ¨åŒ¯å‡ºï¼Œè«‹ç¨å€™â€¦</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // èƒŒæ™¯åŒæ­¥é–‹é—œé è¨­é—œé–‰ï¼Œå¯åœ¨æ­¤è¦†å¯«
    window.DEFAULT_ENABLE_BACKGROUND_SYNC = false;
  </script>
  <script src="export.js"></script>
  <script src="app.js"></script>
</body>
</html>
